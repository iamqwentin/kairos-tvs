<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kairos Academies High School</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --red:#f15b48;
  --navy:#12293c;
  --yellow:#fbaf17;
}

body{
  margin:0;
  background:var(--navy);
  color:white;
  font-family:Segoe UI, Arial, sans-serif;
  overflow:hidden;
}

/* HEADER */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 26px;
  background:#0b1c2b;
}
.header img{height:50px;}
.header h1{font-size:26px;margin:0;}

/* MARQUEE */
.marquee{
  background:var(--red);
  padding:10px 0;
  font-size:22px;
  white-space:nowrap;
  overflow:hidden;
}
.marquee span{
  display:inline-block;
  padding-left:100%;
  animation:scroll 28s linear infinite;
}
@keyframes scroll{to{transform:translateX(-100%);}}

/* LAYOUT */
.container{
  display:grid;
  grid-template-columns:2fr 1fr;
  grid-template-rows:1fr 1fr;
  gap:18px;
  padding:18px;
  height:calc(100vh - 132px);
}

.box{
  background:#0f2235;
  border-radius:18px;
  padding:24px;
}

/* CURRENT PERIOD */
.current h2{font-size:44px;margin:0;}
.countdown{
  font-size:70px;
  font-weight:bold;
  color:var(--red);
}
.upcoming div{
  font-size:22px;
  margin-top:6px;
}

/* TEAMS */
.team{
  background:#071521;
  border-radius:14px;
  padding:16px;
  margin-bottom:12px;
  font-size:22px;
}
.rank{
  font-size:18px;
  color:var(--yellow);
}
.points{
  font-size:40px;
  font-weight:bold;
}

/* OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.overlay h1{
  font-size:64px;
  color:var(--yellow);
  text-align:center;
}
</style>
</head>

<body>

<div class="header">
  <img src="https://static.wixstatic.com/media/06d314_445898c503214a03954d33b952b2ec77~mv2.png">
  <h1>Kairos Academies High School</h1>
</div>

<div class="marquee">
  <span id="marqueeText">Loading announcements…</span>
</div>

<div class="container">

  <!-- CURRENT PERIOD -->
  <div class="box current">
    <h2 id="currentPeriod">No Active Period</h2>
    <div class="countdown" id="countdown">--:--</div>
    <h3 style="margin-top:16px;">Up Next</h3>
    <div class="upcoming" id="upcoming"></div>
  </div>

  <!-- TEAM RANKINGS -->
  <div class="box">
    <h2>Team Rankings</h2>
    <div id="teams"></div>
  </div>

  <!-- EVENTS -->
  <div class="box">
    <h2>This Week</h2>
    <div id="events"></div>
  </div>

</div>

<div class="overlay" id="closedOverlay">
  <h1>School is not in session</h1>
</div>

<script>
/* =========================
   CONFIG
========================= */
const API_URL =
"https://script.google.com/macros/s/AKfycbyVu2M6FxsF0RFRT3KSB4g9heI1wWVInLj8BrvYyCWQNSoC1Soho2MTMo6rI36rqTomAA/exec";

const noSchoolRanges = [
  // Summer / Before School
  ["2025-07-01", "2025-08-15"],

  // Staff Work Days
  ["2025-07-07", "2025-08-01"],

  // Professional Development
  ["2025-08-04", "2025-08-15"],
  ["2025-10-14", "2025-10-17"],
  ["2026-02-17", "2026-02-20"],
  ["2026-05-26", "2026-05-29"],

  // Fall / Winter / Spring Breaks
  ["2025-11-24", "2025-11-28"], // Thanksgiving
  ["2024-12-22", "2026-01-02"], // Winter Break
  ["2026-03-16", "2026-03-20"], // Spring Break

  // Single-Day Holidays
  ["2025-09-01", "2025-09-01"], // Labor Day
  ["2025-10-13", "2025-10-13"], // Indigenous Peoples' Day
  ["2025-11-10", "2025-11-10"], // Veterans Day (Observed)
  ["2026-01-19", "2026-01-19"], // MLK Jr. Day
  ["2026-02-16", "2026-02-16"], // Presidents Day
  ["2026-05-25", "2026-05-25"], // Memorial Day
  ["2026-06-19", "2026-06-19"], // Juneteenth
];


/* SCHEDULES */
const normalSchedule = [
 ["Breakfast","07:45","08:00"],
 ["Mentoring","08:00","09:05"],
 ["2nd Period","09:10","10:25"],
 ["3rd Period","10:30","11:45"],
 ["9/10 Lunch | 11/12 Advisory","11:50","12:17"],
 ["11/12 Lunch | 9/10 Advisory","12:23","12:50"],
 ["6th Period","12:55","14:10"],
 ["7th Period","14:15","15:30"]
];

const wedSchedule = [
 ["Breakfast","07:40","08:00"],
 ["Mentoring","08:00","08:15"],
 ["2nd Period","08:20","09:05"],
 ["3rd Period","09:10","09:55"],
 ["6th Period","10:00","10:45"],
 ["7th Period","10:50","11:35"],
 ["Club / House Hour","11:40","12:50"]
];

/* =========================
   HELPERS
========================= */
function isClosedDay(){
  const now = new Date();
  const day = now.getDay();
  const today = now.toISOString().split("T")[0];

  // Weekends
  if(day === 0 || day === 6) return true;

  // Date ranges
  return noSchoolRanges.some(([start, end]) =>
    today >= start && today <= end
  );
}


/* =========================
   SCHEDULE LOGIC
========================= */
function updateSchedule(){
  if(isClosedDay()){
    document.getElementById("closedOverlay").style.display="flex";
    return;
  }

  const now=new Date();
  const schedule = now.getDay()===3 ? wedSchedule : normalSchedule;
  let current=null, upcoming=[];

  schedule.forEach(p=>{
    const s=toDate(p[1]), e=toDate(p[2]);
    if(now>=s && now<e) current={name:p[0], end:e};
    if(s>now) upcoming.push(p);
  });

  document.getElementById("currentPeriod").textContent =
    current ? current.name : "No Active Period";

  document.getElementById("countdown").textContent =
    current ? `${Math.floor((current.end-now)/60000)}:${String(Math.floor((current.end-now)%60000/1000)).padStart(2,"0")}` : "--:--";

  const up=document.getElementById("upcoming");
  up.innerHTML="";
  upcoming.slice(0,3).forEach(p=>{
    up.innerHTML+=`<div>${p[0]} (${p[1]}–${p[2]})</div>`;
  });

  document.getElementById("closedOverlay").style.display="none";
}

/* =========================
   DATA LOAD
========================= */
async function loadData(){
  const res = await fetch(API_URL);
  const data = await res.json();

  /* TEAM RANKINGS */
  const teamsDiv=document.getElementById("teams");
  teamsDiv.innerHTML="";
  data.teamPoints
    .sort((a,b)=>b.points-a.points)
    .forEach((t,i)=>{
      teamsDiv.innerHTML+=`
        <div class="team">
          <div class="rank">#${i+1}</div>
          ${t.team}
          <div class="points">${t.points}</div>
        </div>`;
    });

  /* EVENTS + MARQUEE */
  const ev=document.getElementById("events");
  ev.innerHTML="";
  let marquee=[];
  data.events.forEach(e=>{
    ev.innerHTML+=`<div><strong>${e.day}:</strong> ${e.event}</div>`;
    marquee.push(`${e.day}: ${e.event}`);
  });
  document.getElementById("marqueeText").textContent =
    marquee.join("   •   ");
}

/* =========================
   LOOPS
========================= */
setInterval(updateSchedule,1000);
setInterval(loadData,60000);

updateSchedule();
loadData();
</script>

</body>
</html>
